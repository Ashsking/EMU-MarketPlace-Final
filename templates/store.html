{% extends "base.html" %}
{% block content %}

<h2 class="text-center">EMU Official Store</h2>

<form method="get" class="mt-2">
  <label>
    Filter by category:
    <select name="category" onchange="this.form.submit()">
      <option value="all">All</option>
      <option value="textbooks" {% if category_filter=='textbooks' %}selected{% endif %}>Textbooks</option>
      <option value="clothing" {% if category_filter=='clothing' %}selected{% endif %}>Clothing</option>
      <option value="dorm" {% if category_filter=='dorm' %}selected{% endif %}>Dorm</option>
      <option value="other" {% if category_filter=='other' %}selected{% endif %}>Other</option>
    </select>
  </label>

  <label>
    Search:
    <input type="search" name="search" value="{{ search_query }}" placeholder="Search store items...">
  </label>
</form>

{% if listings|length == 0 %}
  <div class="empty-state">
    <p style="font-size: 1.2rem; margin-bottom: .5rem;">ðŸ“¦ No items found.</p>
    <p><a href="{{ url_for('store') }}">Reset filters</a></p>
  </div>

{% else %}
  <div class="product-grid mt-2">
    {% for item in listings %}
    <article class="product-card">

      {% if item.image %}
        {% if item.image.startswith("http") %}
          <img src="{{ item.image }}" alt="{{ item.itemName }}">
        {% else %}
          <img src="{{ url_for('static', filename=item.image) }}" alt="{{ item.itemName }}">
        {% endif %}
      {% else %}
        <img src="https://via.placeholder.com/400x250?text=EMU+Merch" alt="No Image">
      {% endif %}

      <div class="product-card-body">
        <span class="badge badge-store">EMU Store</span>
        <span class="badge badge-{{ item.category }}">{{ item.category }}</span>

        <h3>{{ item.itemName }}</h3>
        <p class="price-tag">${{ '%.2f'|format(item.price) }}</p>

        <p style="min-height: 50px;">{{ item.description }}</p>

        <a href="{{ url_for('buy_now', listing_id=item.id) }}" class="contrast">Buy Now</a>
      </div>
    </article>
    {% endfor %}
  </div>
{% endif %}

{% endblock %}
